<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="DSQuery" /><meta property="og:locale" content="en" /><meta name="description" content="Dsquery is a command-line tool that is built into Windows Server 2008. It is available if you have the Active Directory Domain Services (AD DS) server role installed. It allows you to find any objects in the directory using a Lightweight Directory Access Protocol (LDAP) query. To use it, you must run the dsquery command from an elevated command prompt." /><meta property="og:description" content="Dsquery is a command-line tool that is built into Windows Server 2008. It is available if you have the Active Directory Domain Services (AD DS) server role installed. It allows you to find any objects in the directory using a Lightweight Directory Access Protocol (LDAP) query. To use it, you must run the dsquery command from an elevated command prompt." /><link rel="canonical" href="http://theevilsaint.github.io/posts/dsquery/" /><meta property="og:url" content="http://theevilsaint.github.io/posts/dsquery/" /><meta property="og:site_name" content="EvilSaint" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-20T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="DSQuery" /><meta name="twitter:site" content="@_evilsaint_" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-20T00:00:00+01:00","datePublished":"2022-06-20T00:00:00+01:00","description":"Dsquery is a command-line tool that is built into Windows Server 2008. It is available if you have the Active Directory Domain Services (AD DS) server role installed. It allows you to find any objects in the directory using a Lightweight Directory Access Protocol (LDAP) query. To use it, you must run the dsquery command from an elevated command prompt.","headline":"DSQuery","mainEntityOfPage":{"@type":"WebPage","@id":"http://theevilsaint.github.io/posts/dsquery/"},"url":"http://theevilsaint.github.io/posts/dsquery/"}</script><title>DSQuery | EvilSaint</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="EvilSaint"><meta name="application-name" content="EvilSaint"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://evilsaint.com/static/images/evilsaint_shield_logo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">EvilSaint</a></div><div class="site-subtitle font-italic">I void warranties</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://twitter.com/_evilsaint_" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://evilsaint.com/subscribe" aria-label="youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="https://github.com/TheEvilSaint" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.instagram.com/therealevilsaint/" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a> <a href="https://www.facebook.com/TheEvilSaint/" aria-label="facebook" target="_blank" rel="noopener"> <i class="fab fa-facebook"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>DSQuery</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>DSQuery</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1655679600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 20, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.twitter.com/_evilsaint_/">evilsaint</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1061 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><h1 id="dsquery">DSQuery</h1><p>Open DS Query GUI Window</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rundll32 dsquery,OpenQueryWindow
</pre></table></code></div></div><h3 id="users"><span class="mr-2">Users</span><a href="#users" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Query Users From Local server (default 100)</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery user
</pre></table></code></div></div><p>List Users Remote Server (Unlimited or 2000 results)</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>dsquery user <span class="nt">-s</span> 10.100.1.254 <span class="nt">-limit</span> 0
dsquery user <span class="nt">-s</span> 10.100.1.254 <span class="nt">-limit</span> 2000
</pre></table></code></div></div><p>Query a specific user</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>dsquery user <span class="nt">-samid</span> &lt;username&gt; <span class="nt">-s</span> &lt;DC IP Address&gt;
dsquery user <span class="nt">-samid</span> Administrator <span class="nt">-s</span> 10.100.1.254
</pre></table></code></div></div><p>List AD Users starting with ‘b’, don’t limit the number of results returned and request particular fields.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery user <span class="nt">-name</span> <span class="s2">"b*"</span> <span class="nt">-s</span> 10.100.1.254 <span class="nt">-limit</span> 0 | dsget user <span class="nt">-samid</span> <span class="nt">-sid</span> <span class="nt">-fn</span> <span class="nt">-ln</span> <span class="nt">-email</span> <span class="nt">-dept</span> <span class="nt">-disabled</span> <span class="nt">-reversiblepwd</span> <span class="nt">-mustchpwd</span> <span class="nt">-canchpwd</span> <span class="nt">-acctexpires</span> <span class="nt">-s</span> 10.100.1.254
</pre></table></code></div></div><p>How to Reset Active Directory User’s Password from Command Line</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery user <span class="nt">-samid</span> enter_username_here | dsmod user <span class="nt">-pwd</span> enter_new_pw_here <span class="nt">-mustchpwd</span> no
</pre></table></code></div></div><p>Find out if a user account is currently enabled or disabled.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery user <span class="nv">DC</span><span class="o">=</span>%userdnsdomain:.<span class="o">=</span>,DC<span class="o">=</span>% <span class="nt">-name</span> %username% | dsget user <span class="nt">-disabled</span> <span class="nt">-dn</span>
</pre></table></code></div></div><p>Stale user accounts</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery user domainroot <span class="nt">-stalepwd</span> 100 <span class="nt">-limit</span> 0
</pre></table></code></div></div><p>Disabled user accounts</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery user domainroot <span class="nt">-disabled</span> <span class="nt">-limit</span> 0
</pre></table></code></div></div><p>Remotely Reset the Active Directory User’s password from the command line.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>psexec domain_controller_ip dsquery user <span class="nt">-samid</span> enter_username_here | dsmod user <span class="nt">-pwd</span> enter_new_pw_here <span class="nt">-mustchpwd</span> no enter_new_pw_here
</pre></table></code></div></div><h3 id="computers"><span class="mr-2">Computers</span><a href="#computers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>List all computers</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>dsquery computer <span class="nt">-limit</span> 0
dsquery computer <span class="nt">-s</span> 10.100.1.254
dsquery computer <span class="nt">-d</span> marvel.lab
</pre></table></code></div></div><p>Stale computer accounts</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery computer domainroot <span class="nt">-stalepwd</span> 180 <span class="nt">-limit</span> 0
</pre></table></code></div></div><h3 id="loop-through-domain-computers-and-run-a-command"><span class="mr-2">Loop through Domain Computers and run a command</span><a href="#loop-through-domain-computers-and-run-a-command" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Loop through all the computers in the domain (Great for Adding Further Queries)</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">for</span> /f %i <span class="k">in</span> <span class="o">(</span><span class="s1">'dsquery computer -o rdn) do echo %i
</span></pre></table></code></div></div><h3 id="group"><span class="mr-2">Group</span><a href="#group" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>List all groups with Admin in the name</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>dsquery group <span class="nt">-name</span> <span class="s2">"*Admin*"</span> <span class="nt">-s</span> 10.100.1.254
dsquery group <span class="nt">-name</span> <span class="s2">"*Admin*"</span> <span class="nt">-s</span> 10.100.1.254 | dsget group <span class="nt">-members</span> <span class="nt">-expand</span> <span class="nt">-s</span> 10.100.1.254
</pre></table></code></div></div><p>List all members of all group(s)</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery group <span class="nt">-name</span> <span class="s2">"*"</span> <span class="nt">-s</span> 10.100.1.254 | dsget group <span class="nt">-members</span> <span class="nt">-expand</span> <span class="nt">-s</span> 10.100.1.254
</pre></table></code></div></div><p>List all users in security group</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery group <span class="nt">-name</span> <span class="s2">""</span> | dsget group <span class="nt">-members</span> <span class="nt">-expand</span> | dsget user <span class="nt">-fn</span> <span class="nt">-ln</span> <span class="nt">-disabled</span>
</pre></table></code></div></div><h3 id="servers"><span class="mr-2">Servers</span><a href="#servers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Get Domain Controllers</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery server <span class="nt">-s</span> 10.100.1.254
</pre></table></code></div></div><p>Global Catalog (<code class="language-shell highlighter-rouge"><span class="nt">-isgc</span></code>)</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery server <span class="nt">-isgc</span>
</pre></table></code></div></div><h3 id="loop-through-domain-servers-and-run-a-command"><span class="mr-2">Loop through Domain servers and run a command</span><a href="#loop-through-domain-servers-and-run-a-command" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Loop over a list of DC’s using <code class="language-shell highlighter-rouge">dsquery</code> (Great for Adding Further Queries)</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">for</span> /f %i <span class="k">in</span> <span class="o">(</span><span class="s1">'dsquery server -o rdn'</span><span class="o">)</span> <span class="k">do </span><span class="nb">echo</span> %i
</pre></table></code></div></div><p>Domain Controller IP Configuration</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">for</span> /f %i <span class="k">in</span> <span class="o">(</span><span class="s1">'dsquery server -domain %userdnsdomain% -o rdn'</span><span class="o">)</span> <span class="k">do </span>psexec //%i ipconfig /all
</pre></table></code></div></div><p>AD Database disk usage</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">for</span> /f %i <span class="k">in</span> <span class="o">(</span><span class="s1">'dsquery server -domain %userdnsdomain% -o rdn'</span><span class="o">)</span> <span class="k">do </span><span class="nb">dir</span> //%i/admin<span class="nv">$/</span>ntds
</pre></table></code></div></div><p>Domain Controller Netlogon entries</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">for</span> /f %i <span class="k">in</span> <span class="o">(</span><span class="s1">'dsquery server -o rdn'</span><span class="o">)</span> <span class="k">do </span><span class="nb">echo</span> %i &amp; reg query //%i/hklm/system/currentcontrolset/services/netlogon/parameters
</pre></table></code></div></div><p>DNS Zones in AD</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">for</span> /f %i <span class="k">in</span> <span class="o">(</span><span class="s1">'dsquery server -o rdn'</span><span class="o">)</span> <span class="k">do </span>Dsquery <span class="k">*</span> <span class="nt">-s</span> %i domainroot <span class="nt">-filter</span> <span class="o">(</span><span class="nv">objectCategory</span><span class="o">=</span>dnsZone<span class="o">)</span>
</pre></table></code></div></div><p>Enumerate DNS Server Zones</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">for</span> /f %i <span class="k">in</span> <span class="o">(</span><span class="s1">'dsquery server -domain %userdnsdomain% -o rdn'</span><span class="o">)</span> <span class="k">do </span>dnscmd %i /enumzones
</pre></table></code></div></div><h3 id="sites"><span class="mr-2">Sites</span><a href="#sites" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Return the object if KCC Intra/Inter site is disabled for each site</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery site | dsquery <span class="k">*</span> <span class="nt">-attr</span> <span class="k">*</span> <span class="nt">-filter</span> <span class="s2">"(|(Options:1.2.840.113556.1.4.803:=1)(Options:1.2.840.113556.1.4.803:=16))"</span>
</pre></table></code></div></div><p>Return the object if KCC Intra/Inter site is disabled for each site</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery site | dsquery <span class="k">*</span> <span class="nt">-attr</span> <span class="k">*</span> <span class="nt">-filter</span> <span class="s2">"(|(Options:1.2.840.113556.1.4.803:=1)(Options:1.2.840.113556.1.4.803:=16))"</span>
</pre></table></code></div></div><h3 id="subnets"><span class="mr-2">Subnets</span><a href="#subnets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Subnet information</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery subnet <span class="nt">-limit</span> 0
</pre></table></code></div></div><h3 id="ou"><span class="mr-2">OU</span><a href="#ou" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>List Organisational Units</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery OU
</pre></table></code></div></div><p>ACL on all OUs</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">for</span> /f <span class="s2">"delims=|"</span> %i <span class="k">in</span> <span class="o">(</span><span class="s1">'dsquery OU'</span><span class="o">)</span> <span class="k">do </span>acldiag %i
</pre></table></code></div></div><h3 id="custom-queries"><span class="mr-2">Custom Queries</span><a href="#custom-queries" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Remember all below queries can have the following added:</p><ul><li><code class="language-shell highlighter-rouge">s 10.100.1.254</code> will make the command query a remote server. <code class="language-shell highlighter-rouge">d marvel.lab</code> will make the command query a DC in the domain <code class="language-shell highlighter-rouge">limit 0</code> this option will allow ldap to return unlimited results as apposed to the default of 100 records. If 0 is given then the result set will be unlimited.</ul><h3 id="servers-1"><span class="mr-2">Servers</span><a href="#servers-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Find servers in the domain</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> domainroot <span class="nt">-filter</span> <span class="s2">"(&amp;(objectCategory=Computer)(objectClass=Computer)(operatingSystem=*Server*))"</span>
</pre></table></code></div></div><p>Domain Controllers per site</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> <span class="s2">"CN=Sites,CN=Configuration,DC=MARVEL,DC=LAB"</span> <span class="nt">-filter</span> <span class="s2">"(objectCategory=Server)"</span>
</pre></table></code></div></div><p>Global Catalog Servers from AD</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> <span class="s2">"CN=Configuration,DC=MARVEL,DC=LAB"</span> <span class="nt">-filter</span> <span class="s2">"(&amp;(objectCategory=nTDSDSA)(options:1.2.840.113556.1.4.803:=1))"</span>
</pre></table></code></div></div><p>DSQuery authorised DHCP Servers</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> <span class="s2">"cn=NetServices,cn=Services,cn=Configuration,DC=MARVEL,DC=LAB"</span> <span class="nt">-attr</span> dhcpServers
</pre></table></code></div></div><h3 id="users-1"><span class="mr-2">Users</span><a href="#users-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Export all usernames and email addresses</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> <span class="nt">-filter</span> <span class="s2">"(&amp;(objectCategory=person)(objectClass=user)(mail=*))"</span> <span class="nt">-attr</span> sAMAccountName name mail
</pre></table></code></div></div><p>User accounts that are not disabled</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> <span class="nt">-filter</span> <span class="s2">"(&amp;(objectCategory=Person)(objectClass=User)(!userAccountControl:1.2.840.113556.1.4.803:=2))"</span>
</pre></table></code></div></div><p>User accounts that are disabled</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> domainroot <span class="nt">-filter</span> <span class="s2">"(&amp;(objectCategory=Person)(objectClass=User)(userAccountControl:1.2.840.113556.1.4.803:=2))"</span>
</pre></table></code></div></div><p>Users with no logon script</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> domainroot <span class="nt">-filter</span> <span class="s2">"(&amp;(objectCategory=Person)(objectClass=User)(!scriptPath=*))"</span> <span class="nt">-attr</span> sAMAccountName sn givenName pwdLastSet distinguishedName
</pre></table></code></div></div><p>User accounts with no password required</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> domainroot <span class="nt">-filter</span> <span class="s2">"(&amp;(objectCategory=Person)(objectClass=User)(userAccountControl:1.2.840.113556.1.4.803:=32))"</span>
</pre></table></code></div></div><p>User accounts with no password expiry</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> domainroot <span class="nt">-filter</span> <span class="s2">"(&amp;(objectCategory=Person)(objectClass=User)(userAccountControl:1.2.840.113556.1.4.803:=65536))"</span>
</pre></table></code></div></div><p>Find user by account name.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> domainroot <span class="nt">-filter</span> <span class="s2">"(samAccountName=Black.Widow)"</span> <span class="nt">-attr</span> <span class="k">*</span>
</pre></table></code></div></div><p>Find a user by their email address.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> domainroot <span class="nt">-filter</span> <span class="s2">"(&amp;(objectClass=User) (mail=Black.Widow@marvel.lab))"</span> <span class="nt">-attr</span> <span class="k">*</span>
</pre></table></code></div></div><p>Find users with passwords set never to expire.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> domainroot <span class="nt">-filter</span> <span class="s2">"(&amp;(objectClass=User) (userAccountControl&gt;=65536))"</span> <span class="nt">-attr</span> samAccountName userPrincipalName userAccountControl
</pre></table></code></div></div><h3 id="groups"><span class="mr-2">Groups</span><a href="#groups" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Find users in Domain Admin Group.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> <span class="nt">-filter</span> <span class="s2">"&amp;(objectCategory=group)(CN=Domain Admins)"</span> | dsget group <span class="nt">-members</span> | dsget user <span class="nt">-dn</span> <span class="nt">-samid</span> <span class="nt">-sid</span> <span class="nt">-fn</span> <span class="nt">-ln</span> <span class="nt">-display</span> <span class="nt">-email</span>
</pre></table></code></div></div><p>Find empty groups.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> <span class="nt">-filter</span> <span class="s2">"&amp;(objectCategory=group)(!member=*)"</span> <span class="nt">-limit</span> 0 <span class="nt">-attr</span> whenCreated whenChanged groupType sAMAccountName distinguishedName memberOf
</pre></table></code></div></div><h3 id="group-policies"><span class="mr-2">Group Policies</span><a href="#group-policies" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Information on existing GPOs</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> <span class="s2">"CN=Policies,CN=System,DC=MARVEL,DC=LAB"</span> <span class="nt">-filter</span> <span class="s2">"(objectCategory=groupPolicyContainer)"</span> <span class="nt">-attr</span> displayName cnwhenCreated gPCFileSysPath
</pre></table></code></div></div><p>Find the policy display name given the GUID.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> <span class="s2">"CN=Policies,CN=System,DC=MARVEL,DC=LAB"</span> <span class="nt">-filter</span> <span class="s2">"(objectCategory=groupPolicyContainer)"</span> <span class="nt">-attr</span> Name displayName
</pre></table></code></div></div><h3 id="useful-information"><span class="mr-2">Useful Information</span><a href="#useful-information" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Forest/Domain Functional Levels</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> <span class="s2">"cn=partitions,cn=configuration,DC=MARVEL,DC=LAB"</span> <span class="nt">-filter</span> <span class="s2">"(|(systemFlags=3)(systemFlags=-2147483648))"</span> <span class="nt">-attr</span> msDS-Behavior-Version Name dnsroot ntmixeddomain NetBIOSName
</pre></table></code></div></div><p>Find when the AD was installed.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> <span class="s2">"CN=configuration,DC=MARVEL,DC=LAB"</span> <span class="nt">-attr</span> whencreated <span class="nt">-scope</span> base
</pre></table></code></div></div><p>Return the AD Schema</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> <span class="s2">"CN=schema,CN=configuration,DC=MARVEL,DC=LAB"</span> <span class="nt">-scope</span> base <span class="nt">-attr</span> whenCreated whenChanged objectVersion
</pre></table></code></div></div><div class="table-wrapper"><table><thead><tr><th>13<th>Windows 2000 Server operating system<tbody><tr><td>30<td>Windows Server 2003 operating system<tr><td>31<td>Windows Server 2003 R2 operating system<tr><td>44<td>Windows Server 2008 operating system (AD DS)<tr><td>47<td>Windows Server 2008 R2 operating system (AD DS)<tr><td>56<td>Windows Server 2012 operating system (AD DS)<tr><td>69<td>Windows Server 2012 R2 operating system (AD DS)<tr><td>87<td>Windows Server 2016 operating system (AD DS)<tr><td>88<td>Windows Server v1803 operating system (AD DS)</table></div><h3 id="trusts"><span class="mr-2">Trusts</span><a href="#trusts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Enumerate the trusts from the specified domain</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> <span class="s2">"CN=System,DC=MARVEL,DC=LAB"</span> <span class="nt">-filter</span> <span class="s2">"(objectClass=trustedDomain)"</span> <span class="nt">-attr</span> trustPartner flatName
</pre></table></code></div></div><p>Find a DC for each trusted domain</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">for</span> /f <span class="s2">"skip=1"</span> %i <span class="k">in</span> <span class="o">(</span><span class="s1">'"dsquery * CN=System,DC=MARVEL,DC=LAB -filter (objectClass=trustedDomain) -attr *"'</span><span class="o">)</span> <span class="k">do </span>nltest /dsgetdc:%i
</pre></table></code></div></div><h3 id="sites--subnets"><span class="mr-2">Sites &amp; Subnets</span><a href="#sites--subnets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>AD Site Information</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> <span class="s2">"CN=Sites,CN=Configuration,DC=MARVEL,DC=LAB"</span> <span class="nt">-attr</span> cn description location <span class="nt">-filter</span> <span class="s2">"(objectClass=site)"</span>
</pre></table></code></div></div><p>Site Links and Cost</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> <span class="s2">"CN=Sites,CN=Configuration,DC=MARVEL,DC=LAB"</span> <span class="nt">-attr</span> cn costdescription replInterval siteList <span class="nt">-filter</span> <span class="s2">"(objectClass=siteLink)"</span>
</pre></table></code></div></div><p>AD Subnet and Site Information</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dsquery <span class="k">*</span> <span class="s2">"CN=Subnets,CN=Sites,CN=Configuration,DC=MARVEL,DC=LAB"</span> <span class="nt">-attr</span> cn siteObject description location
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/article/'>article</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/dsquery/" class="post-tag no-text-decoration" >dsquery</a> <a href="//tags/ldap/" class="post-tag no-text-decoration" >ldap</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=DSQuery+-+EvilSaint&url=http%3A%2F%2Ftheevilsaint.github.io%2Fposts%2Fdsquery%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=DSQuery+-+EvilSaint&u=http%3A%2F%2Ftheevilsaint.github.io%2Fposts%2Fdsquery%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=http%3A%2F%2Ftheevilsaint.github.io%2Fposts%2Fdsquery%2F&text=DSQuery+-+EvilSaint" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=http%3A%2F%2Ftheevilsaint.github.io%2Fposts%2Fdsquery%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/windows-registry/">Windows Registry</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ssl/">ssl</a> <a class="post-tag" href="/tags/tls/">tls</a> <a class="post-tag" href="/tags/powershell/">powershell</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/enumeration/">enumeration</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/git/">git</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/git-ssh-keys/"><div class="card-body"> <em class="small" data-ts="1618441200" data-df="ll" > Apr 15, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Git with SSH Keys</h3><div class="text-muted small"><p> When working with Git via command line, the easiest way to authenticate is with x.509 keys. This article will show you how to set them up. Introduction With GUI-based Git clients, such as GitHub ...</p></div></div></a></div><div class="card"> <a href="/posts/beginner-guide-apt-commands/"><div class="card-body"> <em class="small" data-ts="1619218800" data-df="ll" > Apr 24, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Beginner Guide To APT Commands</h3><div class="text-muted small"><p> Little history of how apt works? What are sources? Updating sources? Searching for packages Show information about the package Finding packages installed on your machine Finding packages that...</p></div></div></a></div><div class="card"> <a href="/posts/many-hats-pentester/"><div class="card-body"> <em class="small" data-ts="1619218800" data-df="ll" > Apr 24, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The Many Hats Of A Pentester</h3><div class="text-muted small"><p> Hat One - Technical Hat Two - Be able to write well Hat Three - Present to a diverse audience</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/iis-version-header-server-lookup/" class="btn btn-outline-primary" prompt="Older"><p>IIS Version Header Server Lookup</p></a> <a href="//posts/querying-active-directory-with-powershell/" class="btn btn-outline-primary" prompt="Newer"><p>Querying Active Directory With PowerShell</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "TheEvilSaint/theevilsaint.github.io", "data-repo-id": "MDEwOlJlcG9zaXRvcnkyNTQ3ODQ3Nzk", "data-category": "Comments", "data-category-id": "DIC_kwDODy-1C84CSN7z", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ssl/">ssl</a> <a class="post-tag" href="/tags/tls/">tls</a> <a class="post-tag" href="/tags/powershell/">powershell</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/enumeration/">enumeration</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/git/">git</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://www.twitter.com/_evilsaint_/">evilsaint</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"></p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available!</p><button type="button" class="btn btn-primary" aria-label="Update"> Update 🚀 </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-KK5XXRT4LD"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-KK5XXRT4LD'); }); </script>
