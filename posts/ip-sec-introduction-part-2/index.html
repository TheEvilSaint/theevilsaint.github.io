<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="IP Sec - Introduction Part 2" /><meta property="og:locale" content="en" /><meta name="description" content="In the second part of this article on IPSec we will be looking at the difference between main mode and aggressive mode and how to configure IKE in a lab environment using a Windows Server 2016 and a Windows 10 virtual machine. We then proceed to enumerate this setup with some tools bundled in Kali Linux." /><meta property="og:description" content="In the second part of this article on IPSec we will be looking at the difference between main mode and aggressive mode and how to configure IKE in a lab environment using a Windows Server 2016 and a Windows 10 virtual machine. We then proceed to enumerate this setup with some tools bundled in Kali Linux." /><link rel="canonical" href="http://theevilsaint.github.io/posts/ip-sec-introduction-part-2/" /><meta property="og:url" content="http://theevilsaint.github.io/posts/ip-sec-introduction-part-2/" /><meta property="og:site_name" content="EvilSaint" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-04T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="IP Sec - Introduction Part 2" /><meta name="twitter:site" content="@_evilsaint_" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-04T00:00:00+00:00","datePublished":"2022-01-04T00:00:00+00:00","description":"In the second part of this article on IPSec we will be looking at the difference between main mode and aggressive mode and how to configure IKE in a lab environment using a Windows Server 2016 and a Windows 10 virtual machine. We then proceed to enumerate this setup with some tools bundled in Kali Linux.","headline":"IP Sec - Introduction Part 2","mainEntityOfPage":{"@type":"WebPage","@id":"http://theevilsaint.github.io/posts/ip-sec-introduction-part-2/"},"url":"http://theevilsaint.github.io/posts/ip-sec-introduction-part-2/"}</script><title>IP Sec - Introduction Part 2 | EvilSaint</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="EvilSaint"><meta name="application-name" content="EvilSaint"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://evilsaint.com/static/images/evilsaint_shield_logo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">EvilSaint</a></div><div class="site-subtitle font-italic">I void warranties</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://twitter.com/_evilsaint_" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://evilsaint.com/subscribe" aria-label="youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="https://github.com/TheEvilSaint" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.instagram.com/therealevilsaint/" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a> <a href="https://www.facebook.com/TheEvilSaint/" aria-label="facebook" target="_blank" rel="noopener"> <i class="fab fa-facebook"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>IP Sec - Introduction Part 2</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>IP Sec - Introduction Part 2</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1641254400" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jan 4, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.twitter.com/_evilsaint_/">evilsaint</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1436 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><p>Let us go over a summary of the points we covered in the introduction.</p><ul><li>IKE is an implementation of the Internet Security Association Key Management Protocol (ISAKMP) along with the use of Oakley and SKEME protocols.<li>IKE communicates through UDP port 500.<li>IKE authentication methods support pre-shared keys, public-key encryption, and digital signatures.<li>IKE uses a two-phase process to establish the IPsec SA.<li>IKE phase one authenticates the peers who establish an ISAKMP SA, which is used during Phase two. The second Phase establishes an IPsec SA;<li>IKE phase one can run in two modes, ‚Äúmain mode‚Äù or ‚Äúaggressive mode‚Äù.<li>Phase two only has a single mode called Quick mode.</ul><p>Phase one, as mentioned, can be run in two modes called ‚Äúmain mode‚Äù or ‚Äúaggressive mode‚Äù. When testing IPsec VPN systems, we will primarily be dealing with IKE phase one as Phase two is only accessible upon successful authentication.</p><h2 id="main-mode-or-aggressive-mode"><span class="mr-2">‚Äúmain mode‚Äù or ‚Äúaggressive mode‚Äù</span><a href="#main-mode-or-aggressive-mode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Main Mode</p><ul><li>Six messages are sent in total.<li>The expensive DH computation is not performed until after the first packet is exchanged, and the peer IDs are passed encrypted not in the clear.<li>Due to the way it is calculated, it is not possible to use the ‚Äúmain mode‚Äù with pre-shared key authentication unless the IP address of the initiator (client) is known beforehand. Client IPs are usually dynamic in remote access situations.</ul><p>Aggressive mode</p><ul><li>Optional, so not all VPN services will support it.<li>Only three messages are sent in instead of the six used in ‚Äúmain mode‚Äù, which reduces the time required to complete Phase one exchange, but it impacts security integrity because the peer ID is passed in the clear, not encrypted.<li>This mode is generally used in a remote access VPN solution.<li>Aggressive mode is susceptible to resource exhaustion because the expensive DH computation must be performed immediately after receiving the first packet.</ul><h2 id="configuring-ipsec"><span class="mr-2">Configuring IPSec</span><a href="#configuring-ipsec" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Lab Nine in <em>La Maison de saint</em> is the following setup: a Windows Server 2016 and a Windows 10, 64-bit operating system. It can be seen in the screenshot that both machines have non-persistent hard disks and have their operating system build numbers in their title. They are both set up on their own VM Net Number.</p><figure class="figure text-center col-xs-12 col-sm-12 col-lg-12"><img data-src="//static/16e99dcd-fac2-4635-b8d2-19dcf8f1ba91.png" class="figure-img img-fluid border border-1 border-dark" alt=" " data-proofer-ignore><figcaption class="figure-caption text-center fw-normal"></figcaption></figure><figure class="figure text-center col-xs-12 col-sm-12 col-lg-12"><img data-src="//static/f251ca61-a2d6-4d7d-bf93-61d86f0630d3.png" class="figure-img img-fluid border border-1 border-dark" alt=" " data-proofer-ignore><figcaption class="figure-caption text-center fw-normal"></figcaption></figure><aside> üí° Note, the benefit of non-persistent disks is that they will maintain the configuration if the machine is rebooted. However, if the machine is shut down, it will revert to its previous configuration when turned back on.</aside><figure class="figure text-center col-xs-12 col-sm-12 col-lg-12"><img data-src="//static/3f7498cb-d58f-4cb0-9fad-6f58f7ee317f.png" class="figure-img img-fluid border border-1 border-dark" alt=" " data-proofer-ignore><figcaption class="figure-caption text-center fw-normal"></figcaption></figure><figure class="figure text-center col-xs-12 col-sm-12 col-lg-12"><img data-src="//static/e7597ff9-5b3f-454a-a6d2-df0c6b80379e.png" class="figure-img img-fluid border border-1 border-dark" alt=" " data-proofer-ignore><figcaption class="figure-caption text-center fw-normal"></figcaption></figure><p>Initial configuration if we look at the above screenshots, we can identify the two machines‚Äô hostname and IP address. The windows 10 machine is called ‚Äúclient‚Äù, and the Windows Server machine is called ‚Äúserver‚Äù. These are on IP 10.10.10.100 and 10.10.10.250</p><p>There is an IIS default web application on port 80 of the server that we will connect to test the IP Sec configuration. The below screenshot shows the connection to the web application and a blend of TCP and HTTP traffic showing up in Wireshark.</p><figure class="figure text-center col-xs-12 col-sm-12 col-lg-12"><img data-src="//static/2920a73d-9649-43af-abce-d26b900989e8.png" class="figure-img img-fluid border border-1 border-dark" alt=" " data-proofer-ignore><figcaption class="figure-caption text-center fw-normal">Wireshark open and HTTP traffic showing. Web application (IIS default start page)</figcaption></figure><p>Let us navigate to the start menu and open ‚ÄúWindows Firewall with Advanced Security‚Äù.</p><figure class="figure text-center col-xs-12 col-sm-12 col-lg-12"><img data-src="//static/623916a1-7a2f-4c09-b7d9-a660b45ef4b5.png" class="figure-img img-fluid border border-1 border-dark" alt=" " data-proofer-ignore><figcaption class="figure-caption text-center fw-normal"></figcaption></figure><p>We will open the Windows Firewall with Advanced Security, select Connect security policy from the left-hand side, and create a new rule on the right-hand side.</p><figure class="figure text-center col-xs-12 col-sm-12 col-lg-12"><img data-src="//static/da5a5280-fc26-44b4-a4c7-0d55a1fc6cbe.png" class="figure-img img-fluid border border-1 border-dark" alt=" " data-proofer-ignore><figcaption class="figure-caption text-center fw-normal"></figcaption></figure><p>In the modal that appears, we will have five different rule options.</p><ul><li>Isolation<li>Authentication exemption<li>server-to-server<li>Tunnel<li>Custom</ul><p>We will configure a server to server connection.</p><figure class="figure text-center col-xs-12 col-sm-12 col-lg-12"><img data-src="//static/42c71ddf-36a0-42a5-900f-9d6bef82afb0.png" class="figure-img img-fluid border border-1 border-dark" alt=" " data-proofer-ignore><figcaption class="figure-caption text-center fw-normal"></figcaption></figure><p>It will then ask us for the endpoints; we can select the two endpoints per the IP Addresses mentioned earlier.</p><figure class="figure text-center col-xs-12 col-sm-12 col-lg-12"><img data-src="//static/fd0dfa3a-7106-44c3-af8f-50a791ec3170.png" class="figure-img img-fluid border border-1 border-dark" alt=" " data-proofer-ignore><figcaption class="figure-caption text-center fw-normal"></figcaption></figure><p>On the next screen, we are asked several options regarding whether we want to require or request authentication for inbound and outbound scenarios. We want to request authentication for inbound and outbound connections, but we will not require it for communication (It is nice to have, desired but not enforced).</p><figure class="figure text-center col-xs-12 col-sm-12 col-lg-12"><img data-src="//static/7cb25c35-099c-432a-8402-5845d69573fd.png" class="figure-img img-fluid border border-1 border-dark" alt=" " data-proofer-ignore><figcaption class="figure-caption text-center fw-normal"></figcaption></figure><p>On the following screen, we can set up an authentication method. As mentioned previously, we can see computer certificates as one of the authentication options. If we select the Advanced option and click customise, we will be taken to a screen to configure a customised advanced authentication method.</p><figure class="figure text-center col-xs-12 col-sm-12 col-lg-12"><img data-src="//static/7d634e06-f6b9-4435-b7c7-64909235b215.png" class="figure-img img-fluid border border-1 border-dark" alt=" " data-proofer-ignore><figcaption class="figure-caption text-center fw-normal"></figcaption></figure><p>In this case, we will click to add the first authentication method and select the pre-shared key.</p><figure class="figure text-center col-xs-12 col-sm-12 col-lg-12"><img data-src="//static/01176cb6-8749-44ff-9ce8-88868e1fe1d0.png" class="figure-img img-fluid border border-1 border-dark" alt=" " data-proofer-ignore><figcaption class="figure-caption text-center fw-normal"></figcaption></figure><figure class="figure text-center col-xs-12 col-sm-12 col-lg-12"><img data-src="//static/dbb1dab6-5843-4253-a585-c973e23b7494.png" class="figure-img img-fluid border border-1 border-dark" alt=" " data-proofer-ignore><figcaption class="figure-caption text-center fw-normal"></figcaption></figure><p>Pre-Shared Keys (as you can see from the warning) are not recommended; however, they are the easiest way to set up the configuration for our lab.</p><p>We will then click OK and OK again, then select next to move on to the next screen.</p><figure class="figure text-center col-xs-12 col-sm-12 col-lg-12"><img data-src="//static/7179dcfb-f060-43ab-92b4-a05655d52ff8.png" class="figure-img img-fluid border border-1 border-dark" alt=" " data-proofer-ignore><figcaption class="figure-caption text-center fw-normal"></figcaption></figure><p>We will apply this rule to all types of networks, domain, private and public.</p><figure class="figure text-center col-xs-12 col-sm-12 col-lg-12"><img data-src="//static/af164b02-b866-46cc-931f-2973fbd34170.png" class="figure-img img-fluid border border-1 border-dark" alt=" " data-proofer-ignore><figcaption class="figure-caption text-center fw-normal"></figcaption></figure><p>We will now refresh our browser connection and look inside Wireshark. Packets 61 and 62 show are initial connection on TCP port 80 and then shortly after we can now see the six packets that make up the ‚Äúmain mode‚Äù and the following ‚Äúquick mode‚Äù packets.</p><p>Because we have set up a secure connection between two endpoints, as shown in the following screenshots, we will not gain an IKE handshake as our testing machine cannot fall in the endpoint IP range.</p><p>However, if we set the endpoint range to be any in the following range, and we happen to be inside that range, then we might get some output that we can see from our penetration testing tools.</p><figure class="figure text-center col-xs-12 col-sm-12 col-lg-12"><img data-src="//static/03f2b448-4b09-41af-8074-9dfd4e5a24e6.png" class="figure-img img-fluid border border-1 border-dark" alt=" " data-proofer-ignore><figcaption class="figure-caption text-center fw-normal"></figcaption></figure><h2 id="using-ike-scan"><span class="mr-2">Using Ike-Scan</span><a href="#using-ike-scan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We can identify IPsec VPN points with Ike-Scan.</p><p>If we run <code class="language-shell highlighter-rouge">ike-scan</code> against our server with no arguments you can see if has negotiated a handshake and we can see the details of the SA</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>ike-scan 10.10.10.250
Starting ike-scan 1.9.4 with 1 hosts <span class="o">([</span>http://www.nta-monitor.com/tools/ike-scan/]<span class="o">(</span>http://www.nta-monitor.com/tools/ike-scan/<span class="o">))</span>
10.10.10.250    Main Mode Handshake returned <span class="nv">HDR</span><span class="o">=(</span>CKY-R<span class="o">=</span>0cf85f1d8b3df6a4<span class="o">)</span> <span class="nv">SA</span><span class="o">=(</span><span class="nv">Enc</span><span class="o">=</span>3DES <span class="nv">Hash</span><span class="o">=</span>SHA1 <span class="nv">Group</span><span class="o">=</span>2:modp1024 <span class="nv">Auth</span><span class="o">=</span>PSK <span class="nv">LifeType</span><span class="o">=</span>Seconds LifeDuration<span class="o">(</span>4<span class="o">)=</span>0x00007080<span class="o">)</span> <span class="nv">VID</span><span class="o">=</span>1e2b516905991c7d7c96fcbfb587e46100000009 <span class="o">(</span>Windows-8<span class="o">)</span> <span class="nv">VID</span><span class="o">=</span>4a131c81070358455c5728f20e95452f <span class="o">(</span>RFC 3947 NAT-T<span class="o">)</span> <span class="nv">VID</span><span class="o">=</span>90cb80913ebb696e086381b5ec427b1f <span class="o">(</span>draft-ietf-ipsec-nat-t-ike-02<span class="se">\n</span><span class="o">)</span> <span class="nv">VID</span><span class="o">=</span>4048b7d56ebce88525e7de7f00d6c2d3 <span class="o">(</span>IKE Fragmentation<span class="o">)</span> <span class="nv">VID</span><span class="o">=</span>fb1de3cdf341b7ea16b7e5be0855f120 <span class="o">(</span>MS-Negotiation Discovery Capable<span class="o">)</span> <span class="nv">VID</span><span class="o">=</span>e3a5966a76379fe707228231e5ce8652 <span class="o">(</span>IKE CGA version 1<span class="o">)</span>

Ending ike-scan 1.9.4: 1 hosts scanned <span class="k">in </span>0.008 seconds <span class="o">(</span>129.87 hosts/sec<span class="o">)</span><span class="nb">.</span>  1 returned handshake<span class="p">;</span> 0 returned notify
</pre></table></code></div></div><p>For clarity we can add the <code class="language-shell highlighter-rouge"><span class="nt">-M</span></code> option for multi-line mode to make it easier to read.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>ike-scan 10.10.10.250 <span class="nt">-M</span>                                                                                                                                                            
Starting ike-scan 1.9.4 with 1 hosts <span class="o">(</span>http://www.nta-monitor.com/tools/ike-scan/<span class="o">)</span>
10.10.10.250    Main Mode Handshake returned
        <span class="nv">HDR</span><span class="o">=(</span>CKY-R<span class="o">=</span>eb5de8bbb1bcb7d6<span class="o">)</span>
        <span class="nv">SA</span><span class="o">=(</span><span class="nv">Enc</span><span class="o">=</span>3DES <span class="nv">Hash</span><span class="o">=</span>SHA1 <span class="nv">Group</span><span class="o">=</span>2:modp1024 <span class="nv">Auth</span><span class="o">=</span>PSK <span class="nv">LifeType</span><span class="o">=</span>Seconds LifeDuration<span class="o">(</span>4<span class="o">)=</span>0x00007080<span class="o">)</span>
        <span class="nv">VID</span><span class="o">=</span>1e2b516905991c7d7c96fcbfb587e46100000009 <span class="o">(</span>Windows-8<span class="o">)</span>
        <span class="nv">VID</span><span class="o">=</span>4a131c81070358455c5728f20e95452f <span class="o">(</span>RFC 3947 NAT-T<span class="o">)</span>
        <span class="nv">VID</span><span class="o">=</span>90cb80913ebb696e086381b5ec427b1f <span class="o">(</span>draft-ietf-ipsec-nat-t-ike-02<span class="se">\n</span><span class="o">)</span>
        <span class="nv">VID</span><span class="o">=</span>4048b7d56ebce88525e7de7f00d6c2d3 <span class="o">(</span>IKE Fragmentation<span class="o">)</span>
        <span class="nv">VID</span><span class="o">=</span>fb1de3cdf341b7ea16b7e5be0855f120 <span class="o">(</span>MS-Negotiation Discovery Capable<span class="o">)</span>
        <span class="nv">VID</span><span class="o">=</span>e3a5966a76379fe707228231e5ce8652 <span class="o">(</span>IKE CGA version 1<span class="o">)</span>

Ending ike-scan 1.9.4: 1 hosts scanned <span class="k">in </span>0.008 seconds <span class="o">(</span>120.63 hosts/sec<span class="o">)</span><span class="nb">.</span>  1 returned handshake<span class="p">;</span> 0 returned notify
</pre></table></code></div></div><p>If we just want to check the mode i.e. Main or Aggressive then we might want to use the <code class="language-shell highlighter-rouge"><span class="nt">--quiet</span></code> flag to get rid of any superfluous SA information.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>ike-scan 10.10.10.250 <span class="nt">--quiet</span>
Starting ike-scan 1.9.4 with 1 hosts <span class="o">([</span>http://www.nta-monitor.com/tools/ike-scan/]<span class="o">(</span>http://www.nta-monitor.com/tools/ike-scan/<span class="o">))</span>
10.10.10.250    Main Mode Handshake returned

Ending ike-scan 1.9.4: 1 hosts scanned <span class="k">in </span>0.007 seconds <span class="o">(</span>151.15 hosts/sec<span class="o">)</span><span class="nb">.</span>  1 returned handshake<span class="p">;</span> 0 returned notify
</pre></table></code></div></div><p>In this example we have been fortunate to be able to negotiate an SA. However on another endpoint we might not be so successful. We can use the <code class="language-shell highlighter-rouge"><span class="nt">--trans</span></code> flag to specify values that make up a custom transform.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>ike-scan 10.10.10.250 <span class="nt">-M</span> <span class="nt">-v</span> <span class="nt">--trans</span><span class="o">=</span>5,2,1,2
DEBUG: pkt <span class="nv">len</span><span class="o">=</span>84 bytes, <span class="nv">bandwidth</span><span class="o">=</span>56000 bps, <span class="nv">int</span><span class="o">=</span>16000 us
Starting ike-scan 1.9.4 with 1 hosts <span class="o">([</span>http://www.nta-monitor.com/tools/ike-scan/]<span class="o">(</span>http://www.nta-monitor.com/tools/ike-scan/<span class="o">))</span>
10.10.10.250    Main Mode Handshake returned
<span class="nv">HDR</span><span class="o">=(</span>CKY-R<span class="o">=</span>581954ce022c82e2<span class="o">)</span>
<span class="nv">SA</span><span class="o">=(</span><span class="nv">Enc</span><span class="o">=</span>3DES <span class="nv">Hash</span><span class="o">=</span>SHA1 <span class="nv">Group</span><span class="o">=</span>2:modp1024 <span class="nv">Auth</span><span class="o">=</span>PSK <span class="nv">LifeType</span><span class="o">=</span>Seconds LifeDuration<span class="o">(</span>4<span class="o">)=</span>0x00007080<span class="o">)</span>
<span class="nv">VID</span><span class="o">=</span>1e2b516905991c7d7c96fcbfb587e46100000009 <span class="o">(</span>Windows-8<span class="o">)</span>
<span class="nv">VID</span><span class="o">=</span>4a131c81070358455c5728f20e95452f <span class="o">(</span>RFC 3947 NAT-T<span class="o">)</span>
<span class="nv">VID</span><span class="o">=</span>90cb80913ebb696e086381b5ec427b1f <span class="o">(</span>draft-ietf-ipsec-nat-t-ike-02<span class="se">\n</span><span class="o">)</span>
<span class="nv">VID</span><span class="o">=</span>4048b7d56ebce88525e7de7f00d6c2d3 <span class="o">(</span>IKE Fragmentation<span class="o">)</span>
<span class="nv">VID</span><span class="o">=</span>fb1de3cdf341b7ea16b7e5be0855f120 <span class="o">(</span>MS-Negotiation Discovery Capable<span class="o">)</span>
<span class="nv">VID</span><span class="o">=</span>e3a5966a76379fe707228231e5ce8652 <span class="o">(</span>IKE CGA version 1<span class="o">)</span>

Ending ike-scan 1.9.4: 1 hosts scanned <span class="k">in </span>0.007 seconds <span class="o">(</span>135.19 hosts/sec<span class="o">)</span><span class="nb">.</span>  1 returned handshake<span class="p">;</span> 0 returned notify
</pre></table></code></div></div><p>We can lookup the values below</p><p><strong>Encryption Algorithm Values</strong></p><p>1 = DES 2 = IDEA 3 = Blowfish 4 = RC5 5 = Triple DES 6 = CAST 7 = AES 8 = Camellia</p><p><strong>Hash Algorithm Values</strong></p><p>1 = MD5 2 = SHA1 3 = Tiger 4 = SHA2-256 5 = SHA2-384 6 = SHA2-512</p><p><strong>Authentication Method Values</strong></p><p>1 = Pre-Shared Key 2 = DSS Signature 3 = RSA Signature 4 = RSA Encryption 5 = Revised RSA Encryption 6 = ElGamel Encryption 7 = Revised ElGamel Encryption 8 = ECDSA Signature 64221 = Hybrid Mode 65001 = XAUTH</p><p><strong>Diffie-Hellman Group Values</strong></p><p>1 = MODP 768 2 = MODP 1024 3 = EC2N 155 4 = EC2N 185 5 = MODP 1536 6 = EC2N 163 7 = EC2N 163 8 = EC2N 183 9 = EC2N 183 10 = EC2N 409 11 = EC2N 409 12 = EC2N 571 13 = EC2N 571 14 = MODP 2048 15 = MODP 3072 16 = MODP 4096 17 = MODP 6144 18 = MODP 8192</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/article/'>article</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/ike/" class="post-tag no-text-decoration" >ike</a> <a href="//tags/isakmp/" class="post-tag no-text-decoration" >isakmp</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=IP+Sec+-+Introduction+Part+2+-+EvilSaint&url=http%3A%2F%2Ftheevilsaint.github.io%2Fposts%2Fip-sec-introduction-part-2%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=IP+Sec+-+Introduction+Part+2+-+EvilSaint&u=http%3A%2F%2Ftheevilsaint.github.io%2Fposts%2Fip-sec-introduction-part-2%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=http%3A%2F%2Ftheevilsaint.github.io%2Fposts%2Fip-sec-introduction-part-2%2F&text=IP+Sec+-+Introduction+Part+2+-+EvilSaint" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=http%3A%2F%2Ftheevilsaint.github.io%2Fposts%2Fip-sec-introduction-part-2%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/windows-registry/">Windows Registry</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ssl/">ssl</a> <a class="post-tag" href="/tags/tls/">tls</a> <a class="post-tag" href="/tags/powershell/">powershell</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/enumeration/">enumeration</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/git/">git</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ip-sec-introduction/"><div class="card-body"> <em class="small" data-ts="1641168000" data-df="ll" > Jan 3, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>IP Sec - Introduction</h3><div class="text-muted small"><p> IPSec Overview IPSec is a framework of open standards. The benefit of being a framework is that if one component gets superseded, it can be replaced, or additional items can be added. The suite of...</p></div></div></a></div><div class="card"> <a href="/posts/git-ssh-keys/"><div class="card-body"> <em class="small" data-ts="1618441200" data-df="ll" > Apr 15, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Git with SSH Keys</h3><div class="text-muted small"><p> When working with Git via command line, the easiest way to authenticate is with x.509 keys. This article will show you how to set them up. Introduction With GUI-based Git clients, such as GitHub ...</p></div></div></a></div><div class="card"> <a href="/posts/beginner-guide-apt-commands/"><div class="card-body"> <em class="small" data-ts="1619218800" data-df="ll" > Apr 24, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Beginner Guide To APT Commands</h3><div class="text-muted small"><p> Little history of how apt works? What are sources? Updating sources? Searching for packages Show information about the package Finding packages installed on your machine Finding packages that...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/ip-sec-introduction/" class="btn btn-outline-primary" prompt="Older"><p>IP Sec - Introduction</p></a> <a href="//posts/vulnerabilities-ssl-tls-heartbleed/" class="btn btn-outline-primary" prompt="Newer"><p>Vulnerabilities in SSL & TLS :- Heartbleed</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "TheEvilSaint/theevilsaint.github.io", "data-repo-id": "MDEwOlJlcG9zaXRvcnkyNTQ3ODQ3Nzk", "data-category": "Comments", "data-category-id": "DIC_kwDODy-1C84CSN7z", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ssl/">ssl</a> <a class="post-tag" href="/tags/tls/">tls</a> <a class="post-tag" href="/tags/powershell/">powershell</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/enumeration/">enumeration</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/git/">git</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> ¬© 2023 <a href="https://www.twitter.com/_evilsaint_/">evilsaint</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"></p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available!</p><button type="button" class="btn btn-primary" aria-label="Update"> Update üöÄ </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-KK5XXRT4LD"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-KK5XXRT4LD'); }); </script>
